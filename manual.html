<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>SDGE ‚Äî eManual</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{background:#030b1a;color:#e2e8f0;font-family:'Segoe UI',system-ui,sans-serif;min-height:100vh;display:flex;flex-direction:column}
nav{background:rgba(255,255,255,.03);border-bottom:1px solid rgba(255,255,255,.08);padding:.75rem 1.5rem;display:flex;align-items:center;gap:1.5rem;flex-wrap:wrap}
.brand{display:flex;align-items:center;gap:8px;margin-right:auto}
.brand-icon{font-size:22px}
.brand-name{font-size:16px;font-weight:800;color:#fff}
.brand-sub{font-size:10px;color:rgba(255,255,255,.35);margin-top:1px}
nav a{color:rgba(255,255,255,.5);text-decoration:none;font-size:.82rem;font-weight:500;transition:color .2s}
nav a:hover{color:#fff}
nav a.active{color:#60a5fa}
.login-btn{background:rgba(29,78,216,.2);border:1px solid rgba(29,78,216,.4);border-radius:6px;padding:.3rem .75rem;color:#93c5fd!important}
.login-btn:hover{background:rgba(29,78,216,.35)!important}

.layout{display:flex;flex:1;max-width:1200px;margin:0 auto;width:100%;padding:0}

/* Sidebar TOC */
.sidebar{width:240px;flex-shrink:0;padding:1.5rem 1rem 2rem;position:sticky;top:0;height:calc(100vh - 53px);overflow-y:auto;border-right:1px solid rgba(255,255,255,.06)}
.toc-group{margin-bottom:1.25rem}
.toc-group-title{font-size:.65rem;font-weight:700;color:rgba(255,255,255,.25);text-transform:uppercase;letter-spacing:.09em;margin-bottom:.5rem;padding-left:.25rem}
.toc-link{display:block;font-size:.8rem;color:rgba(255,255,255,.45);text-decoration:none;padding:.3rem .5rem;border-radius:5px;transition:all .15s;border-left:2px solid transparent}
.toc-link:hover{color:#fff;background:rgba(255,255,255,.05)}
.toc-link.active{color:#60a5fa;border-left-color:#3b82f6;background:rgba(59,130,246,.08)}

/* Content */
.content{flex:1;padding:2rem 2.5rem 4rem;max-width:800px;overflow-x:hidden}
.content h1{font-size:1.75rem;font-weight:800;color:#fff;margin-bottom:.4rem}
.content .subtitle{color:rgba(255,255,255,.4);font-size:.9rem;margin-bottom:2rem;line-height:1.5}

section{margin-bottom:3rem;scroll-margin-top:1.5rem}
section h2{font-size:1.2rem;font-weight:700;color:#fff;margin-bottom:1rem;padding-bottom:.5rem;border-bottom:1px solid rgba(255,255,255,.08);display:flex;align-items:center;gap:.5rem}
section h3{font-size:.95rem;font-weight:700;color:#e2e8f0;margin-bottom:.6rem;margin-top:1.25rem}
p{color:rgba(255,255,255,.65);font-size:.88rem;line-height:1.75;margin-bottom:.875rem}
ul,ol{color:rgba(255,255,255,.6);font-size:.87rem;line-height:1.7;padding-left:1.25rem;margin-bottom:.875rem}
li{margin-bottom:.25rem}

/* Code blocks */
.code{background:#000;border:1px solid rgba(255,255,255,.08);border-radius:8px;padding:1rem 1.125rem;font-family:'Courier New',monospace;font-size:.78rem;color:#86efac;overflow-x:auto;margin:.75rem 0 1rem;line-height:1.65}
.code .cm{color:rgba(255,255,255,.3)}
.code .kw{color:#93c5fd}
.code .st{color:#fde68a}
.code .ty{color:#c4b5fd}

/* Info boxes */
.info-box{background:rgba(59,130,246,.08);border:1px solid rgba(59,130,246,.2);border-radius:8px;padding:.875rem 1rem;margin:1rem 0;font-size:.83rem;color:rgba(255,255,255,.75);line-height:1.6}
.info-box.warn{background:rgba(234,179,8,.07);border-color:rgba(234,179,8,.25)}
.info-box.ok{background:rgba(34,197,94,.07);border-color:rgba(34,197,94,.2)}
.info-box strong{color:#fff}

/* Domain grid */
.domain-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:.75rem;margin:.75rem 0 1rem}
.domain-card{background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.07);border-radius:8px;padding:.75rem 1rem;font-size:.8rem}
.domain-card .dicon{font-size:1.3rem;margin-bottom:.3rem}
.domain-card .dname{font-weight:700;color:#fff;font-size:.82rem}
.domain-card .dex{color:rgba(255,255,255,.35);font-size:.72rem;margin-top:.15rem}

/* API table */
table{width:100%;border-collapse:collapse;font-size:.8rem;margin:.75rem 0 1rem}
th{text-align:left;font-size:.72rem;font-weight:700;color:rgba(255,255,255,.35);text-transform:uppercase;letter-spacing:.06em;border-bottom:1px solid rgba(255,255,255,.08);padding:.5rem .75rem}
td{padding:.55rem .75rem;border-bottom:1px solid rgba(255,255,255,.05);color:rgba(255,255,255,.65);vertical-align:top}
tr:hover td{background:rgba(255,255,255,.02)}
.method{font-family:monospace;font-size:.75rem;font-weight:700;padding:.15rem .4rem;border-radius:4px}
.method.q{background:rgba(59,130,246,.2);color:#93c5fd}
.method.m{background:rgba(139,92,246,.2);color:#c4b5fd}
code{background:rgba(255,255,255,.08);border-radius:3px;padding:.1rem .35rem;font-size:.8em;font-family:monospace;color:#e2e8f0}

/* Badge */
.badge{display:inline-block;font-size:.65rem;font-weight:700;padding:.15rem .4rem;border-radius:4px;text-transform:uppercase;letter-spacing:.04em}
.badge-auth{background:rgba(234,179,8,.15);color:#fde68a}
.badge-open{background:rgba(34,197,94,.12);color:#86efac}

/* Steps (numbered) */
.steps-list{counter-reset:steps;list-style:none;padding-left:0}
.steps-list li{display:flex;gap:.75rem;margin-bottom:.75rem;counter-increment:steps}
.steps-list li::before{content:counter(steps);background:rgba(29,78,216,.3);color:#93c5fd;border-radius:50%;min-width:22px;height:22px;display:flex;align-items:center;justify-content:center;font-size:.7rem;font-weight:700;flex-shrink:0;margin-top:1px}
.steps-list li span{color:rgba(255,255,255,.65);font-size:.87rem;line-height:1.6}
</style>
</head>
<body>

<nav>
  <div class="brand">
    <span class="brand-icon">üìú</span>
    <div>
      <div class="brand-name">SDGE</div>
      <div class="brand-sub">Sovereign Document Governance Engine</div>
    </div>
  </div>
  <a href="/">Home</a>
  <a href="/dashboard">Dashboard</a>
  <a href="/wizard">Wizard</a>
  <a href="/workflows">Workflows</a>
  <a href="/manual" class="active">Manual</a>
  <a href="/login" class="login-btn">Login</a>
</nav>

<div class="layout">

  <!-- Sidebar TOC -->
  <aside class="sidebar">
    <div class="toc-group">
      <div class="toc-group-title">Introduction</div>
      <a href="#overview" class="toc-link active">Overview</a>
      <a href="#quickstart" class="toc-link">Quick Start</a>
      <a href="#concepts" class="toc-link">Core Concepts</a>
    </div>
    <div class="toc-group">
      <div class="toc-group-title">Actors & Auth</div>
      <a href="#actors" class="toc-link">Actor Roles</a>
      <a href="#auth" class="toc-link">Authentication</a>
      <a href="#sessions" class="toc-link">Sessions</a>
    </div>
    <div class="toc-group">
      <div class="toc-group-title">Domains</div>
      <a href="#domains" class="toc-link">All 15 Domains</a>
      <a href="#classify" class="toc-link">Auto-Classification</a>
    </div>
    <div class="toc-group">
      <div class="toc-group-title">Ingesting Docs</div>
      <a href="#ingest" class="toc-link">Ingest Guide</a>
      <a href="#wizard-guide" class="toc-link">Using the Wizard</a>
      <a href="#bulk" class="toc-link">Bulk Ingest</a>
    </div>
    <div class="toc-group">
      <div class="toc-group-title">Ledger & Chain</div>
      <a href="#ledger" class="toc-link">Sovereign Ledger</a>
      <a href="#verify" class="toc-link">Chain Verification</a>
      <a href="#zk" class="toc-link">ZK Receipts</a>
    </div>
    <div class="toc-group">
      <div class="toc-group-title">API Reference</div>
      <a href="#graphql" class="toc-link">GraphQL Schema</a>
      <a href="#queries" class="toc-link">Queries</a>
      <a href="#mutations" class="toc-link">Mutations</a>
    </div>
    <div class="toc-group">
      <div class="toc-group-title">Workflows</div>
      <a href="#workflow-guide" class="toc-link">Automation Guide</a>
      <a href="#fraud" class="toc-link">Fraud Detection</a>
    </div>
  </aside>

  <!-- Main Content -->
  <div class="content">
    <h1>üìò SDGE eManual</h1>
    <p class="subtitle">Complete reference for the Sovereign Document Governance Engine ‚Äî ingestion, verification, workflows, and API.</p>

    <!-- Overview -->
    <section id="overview">
      <h2>üèõÔ∏è Overview</h2>
      <p>SDGE (Sovereign Document Governance Engine) is an append-only, hash-chained document ledger designed for Indian Government document governance. It provides tamper-evident storage, ZK receipts, fraud scoring, and a GraphQL-first API for 15 governance domains.</p>
      <p>Key properties:</p>
      <ul>
        <li><strong>Append-only</strong> ‚Äî documents are never modified or deleted once committed</li>
        <li><strong>SHA-256 chained</strong> ‚Äî each block links to the previous block's hash (like a blockchain)</li>
        <li><strong>Domain-scoped</strong> ‚Äî all 15 departments have isolated namespaces with domain-specific metadata</li>
        <li><strong>Actor-authenticated</strong> ‚Äî every ingest is attributed to a verified government actor</li>
        <li><strong>Fraud-scored</strong> ‚Äî every document receives a fraud risk score (0‚Äì100) on ingest</li>
      </ul>
      <div class="info-box ok">
        <strong>Live system:</strong> SDGE runs on port 4103 (Bun + Fastify + Mercurius). The current ledger has <strong id="doc-count">‚Äî</strong> documents across all 15 domains.
      </div>
    </section>

    <!-- Quick Start -->
    <section id="quickstart">
      <h2>üöÄ Quick Start</h2>
      <ol class="steps-list">
        <li><span>Go to <a href="/login" style="color:#60a5fa">/login</a> and select your department actor (all demo actors use PIN <code>1234</code>)</span></li>
        <li><span>After login, visit <a href="/wizard" style="color:#60a5fa">/wizard</a> ‚Äî the 5-step guided document ingest tool</span></li>
        <li><span>Select your domain, fill document metadata, paste content, review, and confirm</span></li>
        <li><span>Your document is hashed, assigned a ledger sequence number, and a ZK receipt is issued</span></li>
        <li><span>Verify any document at any time via the <a href="/dashboard" style="color:#60a5fa">/dashboard</a> ‚Üí Document Lookup tab</span></li>
      </ol>
      <div class="info-box">
        <strong>Note:</strong> In the current demo, all actors share PIN <code>1234</code>. Production deployment uses UIDAI-linked biometric or eSign-based authentication.
      </div>
    </section>

    <!-- Core Concepts -->
    <section id="concepts">
      <h2>üí° Core Concepts</h2>
      <h3>Document</h3>
      <p>A sovereign document is any government-issued record: certificate, order, filing, report, or sensor reading. Each document has a unique <code>docId</code> (UUID), a SHA-256 <code>contentHash</code>, a <code>domain</code>, an <code>actorId</code>, and an <code>ingestTime</code>.</p>
      <h3>Ledger Entry</h3>
      <p>When a document is ingested, a <strong>ledger entry</strong> is created with a monotonically increasing <code>ledgerSeq</code>. Each entry stores the hash of its content plus the <code>prevHash</code> of the prior entry, forming an unbreakable chain.</p>
      <h3>Fraud Score</h3>
      <p>Every document is scored 0‚Äì100 at ingest time by the SDGE fraud engine. Score interpretation:</p>
      <ul>
        <li><strong>0‚Äì29</strong> ‚Äî Low risk (green) ‚Äî routine document</li>
        <li><strong>30‚Äì59</strong> ‚Äî Medium risk (yellow) ‚Äî review recommended</li>
        <li><strong>60‚Äì79</strong> ‚Äî High risk (orange) ‚Äî manual verification required</li>
        <li><strong>80‚Äì100</strong> ‚Äî Critical (red) ‚Äî flagged for fraud investigation</li>
      </ul>
    </section>

    <!-- Actors -->
    <section id="actors">
      <h2>üë§ Actor Roles</h2>
      <p>Every SDGE operation is performed by an <strong>actor</strong> ‚Äî an authenticated government officer. Actors are scoped to their department's domain.</p>
      <table>
        <tr><th>Actor ID</th><th>Name</th><th>Domain</th></tr>
        <tr><td><code>actor-land-reg-01</code></td><td>Land Registry</td><td>LAND</td></tr>
        <tr><td><code>actor-hospital-01</code></td><td>Civil Hospital</td><td>HEALTH</td></tr>
        <tr><td><code>actor-agri-dept-01</code></td><td>Agriculture Dept</td><td>AGRICULTURE</td></tr>
        <tr><td><code>actor-gem-01</code></td><td>GeM Procurement</td><td>PROCUREMENT</td></tr>
        <tr><td><code>actor-cbse-01</code></td><td>CBSE</td><td>EDUCATION</td></tr>
        <tr><td><code>actor-gst-01</code></td><td>GST / Supply</td><td>SUPPLY_CHAIN</td></tr>
        <tr><td><code>actor-fcs-01</code></td><td>FCS / PDS</td><td>SUPPLY_CHAIN (PDS)</td></tr>
        <tr><td><code>actor-discom-01</code></td><td>DISCOM / IoT</td><td>IOT</td></tr>
        <tr><td><code>actor-gst-dept-01</code></td><td>Tax Dept (GST)</td><td>TAXATION</td></tr>
        <tr><td><code>actor-uidai-01</code></td><td>UIDAI / Identity</td><td>IDENTITY</td></tr>
        <tr><td><code>actor-court-01</code></td><td>District Court</td><td>JUDICIARY</td></tr>
        <tr><td><code>actor-mcd-01</code></td><td>Municipal Corp</td><td>URBAN_LOCAL</td></tr>
        <tr><td><code>actor-sbi-01</code></td><td>Bank / Finance</td><td>FINANCE</td></tr>
        <tr><td><code>actor-epfo-01</code></td><td>EPFO / Labour</td><td>LABOUR</td></tr>
        <tr><td><code>actor-rto-dl-01</code></td><td>RTO / Transport</td><td>TRANSPORT</td></tr>
      </table>
    </section>

    <!-- Auth -->
    <section id="auth">
      <h2>üîê Authentication</h2>
      <p>SDGE uses actor-based PIN authentication in this demo. The session is stored in browser <code>localStorage</code> as <code>sdge_actor</code> ‚Äî a JSON object with <code>id</code>, <code>name</code>, <code>role</code>, <code>domain</code>, and <code>icon</code>.</p>
      <div class="code"><span class="cm">// Example session object in localStorage</span>
{
  <span class="st">"id"</span>: <span class="st">"actor-land-reg-01"</span>,
  <span class="st">"name"</span>: <span class="st">"Land Registry"</span>,
  <span class="st">"role"</span>: <span class="st">"District Registrar"</span>,
  <span class="st">"domain"</span>: <span class="st">"LAND"</span>,
  <span class="st">"icon"</span>: <span class="st">"üèöÔ∏è"</span>
}</div>
      <p>The ingest console on the Dashboard checks for this session. If absent, the ingest form is hidden. The wizard also pre-fills the Actor ID from this session.</p>
      <div class="info-box warn">
        <strong>Security note:</strong> This is a demo system. Production SDGE uses UIDAI-authenticated JWT tokens with 4-hour expiry, signed with the department's DSC (Digital Signature Certificate).
      </div>
    </section>

    <!-- Sessions -->
    <section id="sessions">
      <h2>üóùÔ∏è Sessions</h2>
      <p>Sessions are browser-local and persist until explicitly cleared. To log out, the session is removed from <code>localStorage</code>. If you clear your browser storage, you will be logged out and redirected to <code>/login</code>.</p>
    </section>

    <!-- Domains -->
    <section id="domains">
      <h2>üóÇÔ∏è All 15 Governance Domains</h2>
      <p>SDGE covers all major Indian government document domains. Each domain has its own namespace, auto-classification patterns, and domain-specific metadata fields.</p>
      <div class="domain-grid">
        <div class="domain-card"><div class="dicon">üèöÔ∏è</div><div class="dname">LAND</div><div class="dex">Khasra, mutation certs, e-Nakal, jamabandi</div></div>
        <div class="domain-card"><div class="dicon">üè•</div><div class="dname">HEALTH</div><div class="dex">OPD cards, ABHA records, discharge summaries</div></div>
        <div class="domain-card"><div class="dicon">üåæ</div><div class="dname">AGRICULTURE</div><div class="dex">MSP docs, crop insurance, PM-KISAN</div></div>
        <div class="domain-card"><div class="dicon">üì¶</div><div class="dname">PROCUREMENT</div><div class="dex">GeM POs, tenders, vendor contracts</div></div>
        <div class="domain-card"><div class="dicon">üìö</div><div class="dname">EDUCATION</div><div class="dex">CBSE marksheets, certificates, admit cards</div></div>
        <div class="domain-card"><div class="dicon">üö¢</div><div class="dname">SUPPLY_CHAIN</div><div class="dex">GST e-way bills, invoices, logistics</div></div>
        <div class="domain-card"><div class="dicon">üõí</div><div class="dname">PDS</div><div class="dex">Ration cards, FCS registers, PDS allocations</div></div>
        <div class="domain-card"><div class="dicon">üì°</div><div class="dname">IOT</div><div class="dex">Smart meter data, SCADA logs, sensor reports</div></div>
        <div class="domain-card"><div class="dicon">üßæ</div><div class="dname">TAXATION</div><div class="dex">GSTR filings, income tax, PAN records</div></div>
        <div class="domain-card"><div class="dicon">ü™™</div><div class="dname">IDENTITY</div><div class="dex">Aadhaar docs, voter ID, DigiLocker</div></div>
        <div class="domain-card"><div class="dicon">‚öñÔ∏è</div><div class="dname">JUDICIARY</div><div class="dex">FIRs, court orders, judgements, summons</div></div>
        <div class="domain-card"><div class="dicon">üèôÔ∏è</div><div class="dname">URBAN_LOCAL</div><div class="dex">Property tax, building permits, birth/death</div></div>
        <div class="domain-card"><div class="dicon">üè¶</div><div class="dname">FINANCE</div><div class="dex">Loan sanction letters, bank statements, KCC</div></div>
        <div class="domain-card"><div class="dicon">üë∑</div><div class="dname">LABOUR</div><div class="dex">PF passbooks, ESIC, labour contracts</div></div>
        <div class="domain-card"><div class="dicon">üöó</div><div class="dname">TRANSPORT</div><div class="dex">Driving licences, vehicle registration, fitness</div></div>
      </div>
    </section>

    <!-- Classification -->
    <section id="classify">
      <h2>ü§ñ Auto-Classification</h2>
      <p>When you select <strong>"Auto-detect domain"</strong> in the Wizard or via the GraphQL mutation, SDGE scans the document content for domain-specific signals:</p>
      <table>
        <tr><th>Domain</th><th>Signals (regex patterns)</th></tr>
        <tr><td>LAND</td><td><code>khasra</code>, <code>khatauni</code>, <code>mutation</code>, <code>registry</code>, <code>e-nakal</code></td></tr>
        <tr><td>HEALTH</td><td><code>opd</code>, <code>prescription</code>, <code>patient</code>, <code>discharge</code>, <code>abha</code></td></tr>
        <tr><td>AGRICULTURE</td><td><code>msp</code>, <code>kisan</code>, <code>fasal</code>, <code>pm-kisan</code>, <code>crop insurance</code></td></tr>
        <tr><td>PROCUREMENT</td><td><code>gem</code>, <code>tender</code>, <code>purchase order</code>, <code>bid</code>, <code>procurement</code></td></tr>
        <tr><td>EDUCATION</td><td><code>cbse</code>, <code>marksheet</code>, <code>result</code>, <code>admit card</code>, <code>roll number</code></td></tr>
        <tr><td>TAXATION</td><td><code>gstin</code>, <code>gstr</code>, <code>tax invoice</code>, <code>pan</code>, <code>income tax</code></td></tr>
        <tr><td>IDENTITY</td><td><code>aadhaar</code>, <code>uid</code>, <code>voter id</code>, <code>digilocker</code></td></tr>
        <tr><td>JUDICIARY</td><td><code>fir</code>, <code>court order</code>, <code>judgement</code>, <code>summons</code>, <code>case no</code></td></tr>
        <tr><td>TRANSPORT</td><td><code>driving licence</code>, <code>dl no</code>, <code>rc book</code>, <code>vehicle registration</code></td></tr>
      </table>
      <p>If no patterns match, the document is classified as <code>UNKNOWN</code>. You can always override the auto-detected domain by selecting one manually.</p>
    </section>

    <!-- Ingest Guide -->
    <section id="ingest">
      <h2>üì• Ingest Guide</h2>
      <p>There are three ways to ingest a document:</p>
      <h3>1. Dashboard Ingest Form</h3>
      <p>On <a href="/dashboard" style="color:#60a5fa">/dashboard</a>, switch to the <em>Ingest Document</em> tab. You must be logged in. Fill the form and submit ‚Äî the ledger entry is shown inline.</p>
      <h3>2. Wizard (Recommended)</h3>
      <p>The <a href="/wizard" style="color:#60a5fa">/wizard</a> provides a guided 5-step flow with per-domain metadata fields, auto-detect, a review step, and a formatted ZK receipt on completion. Best for manual document entry.</p>
      <h3>3. GraphQL Mutation</h3>
      <p>For programmatic ingest (integrations, batch scripts, workflow automations):</p>
      <div class="code"><span class="kw">mutation</span> {
  sdgeIngestDocument(input: {
    filename:  <span class="st">"gstr3b-jul-2025.pdf"</span>,
    actorId:   <span class="st">"actor-gst-dept-01"</span>,
    domain:    <span class="ty">TAXATION</span>,
    content:   <span class="st">"GSTIN: 07AAACR0932J1ZT | Period: Jul 2025 | Tax: ‚Çπ2,47,500"</span>
  }) {
    docId
    ledgerSeq
    fraudScore
    fraudLevel
    zkReceiptId
    contentHash
    ingestTime
  }
}</div>
    </section>

    <!-- Wizard Guide -->
    <section id="wizard-guide">
      <h2>üßô Using the Wizard</h2>
      <p>The wizard at <a href="/wizard" style="color:#60a5fa">/wizard</a> walks you through 5 steps:</p>
      <ol class="steps-list">
        <li><span><strong>Select Domain</strong> ‚Äî Choose from 15 domain tiles. Each has an icon, name, and document count badge.</span></li>
        <li><span><strong>Document Details</strong> ‚Äî Enter filename, verify your actor ID (pre-filled from session), and fill domain-specific fields (e.g., GSTIN for TAXATION, Case No. for JUDICIARY).</span></li>
        <li><span><strong>Paste Content</strong> ‚Äî Enter the document text. Optionally enable <em>Auto-detect domain</em> to re-classify based on content.</span></li>
        <li><span><strong>Review</strong> ‚Äî A summary panel shows all fields before commit. Confirm or go back to edit.</span></li>
        <li><span><strong>Receipt</strong> ‚Äî After successful ingest, a formatted ZK receipt is displayed with <code>docId</code>, <code>ledgerSeq</code>, <code>contentHash</code>, fraud score, and a sharable receipt ID.</span></li>
      </ol>
    </section>

    <!-- Bulk Ingest -->
    <section id="bulk">
      <h2>üì¶ Bulk Ingest</h2>
      <p>For batch ingestion, use the <a href="/workflows" style="color:#60a5fa">/workflows</a> automation page. Each workflow can ingest multiple documents in a single run. Alternatively, use the GraphQL mutation in a loop from your backend service.</p>
      <div class="code"><span class="cm">// Node.js / Bun batch example</span>
<span class="kw">const</span> docs = [<span class="st">"doc1 content"</span>, <span class="st">"doc2 content"</span>];
<span class="kw">for</span> (<span class="kw">const</span> content <span class="kw">of</span> docs) {
  <span class="kw">await</span> fetch(<span class="st">'https://sdge.ankrlabs.org/graphql'</span>, {
    method: <span class="st">'POST'</span>,
    headers: { <span class="st">'Content-Type'</span>: <span class="st">'application/json'</span> },
    body: JSON.stringify({ query: <span class="st">`mutation { sdgeIngestDocument(input:{
      filename:"batch.dat", actorId:"actor-land-reg-01",
      domain: LAND, content:"${content}"
    }) { docId ledgerSeq } }`</span> })
  });
}</div>
    </section>

    <!-- Ledger -->
    <section id="ledger">
      <h2>üîó Sovereign Ledger</h2>
      <p>The SDGE ledger is an in-memory, append-only chain. Each entry has:</p>
      <table>
        <tr><th>Field</th><th>Type</th><th>Description</th></tr>
        <tr><td><code>ledgerSeq</code></td><td>number</td><td>Monotonically increasing sequence number</td></tr>
        <tr><td><code>docId</code></td><td>UUID</td><td>Unique document identifier</td></tr>
        <tr><td><code>contentHash</code></td><td>SHA-256 hex</td><td>Hash of filename+actorId+domain+content</td></tr>
        <tr><td><code>prevHash</code></td><td>SHA-256 hex</td><td>Hash of the previous ledger entry</td></tr>
        <tr><td><code>ingestTime</code></td><td>ISO timestamp</td><td>UTC timestamp of ingest</td></tr>
        <tr><td><code>fraudScore</code></td><td>0‚Äì100</td><td>Fraud risk score at ingest time</td></tr>
        <tr><td><code>zkReceiptId</code></td><td>UUID</td><td>Zero-knowledge proof receipt identifier</td></tr>
      </table>
      <div class="info-box warn">
        <strong>Persistence:</strong> The current demo ledger is in-memory and resets when the backend restarts. A production SDGE deployment uses PostgreSQL with an append-only table enforced at the DB level (no UPDATE/DELETE triggers).
      </div>
    </section>

    <!-- Verify -->
    <section id="verify">
      <h2>‚úÖ Chain Verification</h2>
      <p>Use the <em>Verify Chain</em> tab on the Dashboard to check the integrity of any document or the entire chain:</p>
      <div class="code"><span class="kw">query</span> {
  sdgeVerifyChain {
    chainLength
    isValid
    lastHash
    brokenAt
  }
}

<span class="cm">// Or verify a single document by docId:</span>
<span class="kw">query</span> {
  sdgeLookupDoc(docId: <span class="st">"&lt;uuid&gt;"</span>) {
    docId
    contentHash
    ledgerSeq
    fraudScore
    fraudLevel
    ingestTime
  }
}</div>
    </section>

    <!-- ZK Receipts -->
    <section id="zk">
      <h2>üîè ZK Receipts</h2>
      <p>Every successful ingest issues a <strong>Zero-Knowledge Receipt</strong> ‚Äî a UUID that can be shared publicly to prove a document was committed to the chain at a specific time, without revealing the document content itself.</p>
      <p>The ZK receipt ID is derived from the <code>contentHash</code> and <code>ledgerSeq</code>. It can be verified by anyone with access to the SDGE API:</p>
      <div class="code"><span class="kw">query</span> {
  sdgeLookupReceipt(receiptId: <span class="st">"&lt;zkReceiptId&gt;"</span>) {
    valid
    docId
    domain
    ingestTime
    ledgerSeq
  }
}</div>
    </section>

    <!-- GraphQL Schema -->
    <section id="graphql">
      <h2>üìê GraphQL Schema</h2>
      <p>All SDGE operations are exposed via a single GraphQL endpoint: <code>POST https://sdge.ankrlabs.org/graphql</code></p>
      <div class="code"><span class="kw">type</span> <span class="ty">SdgeDocument</span> {
  docId:        <span class="ty">String!</span>
  filename:     <span class="ty">String!</span>
  actorId:      <span class="ty">String!</span>
  domain:       <span class="ty">DocumentDomain!</span>
  contentHash:  <span class="ty">String!</span>
  ledgerSeq:    <span class="ty">Int!</span>
  fraudScore:   <span class="ty">Int!</span>
  fraudLevel:   <span class="ty">String!</span>
  zkReceiptId:  <span class="ty">String!</span>
  ingestTime:   <span class="ty">String!</span>
}

<span class="kw">enum</span> <span class="ty">DocumentDomain</span> {
  LAND HEALTH AGRICULTURE PROCUREMENT EDUCATION
  SUPPLY_CHAIN IOT PDS TAXATION IDENTITY
  JUDICIARY URBAN_LOCAL FINANCE LABOUR TRANSPORT UNKNOWN
}</div>
    </section>

    <!-- Queries -->
    <section id="queries">
      <h2>üîé Queries</h2>
      <table>
        <tr><th>Query</th><th>Auth</th><th>Description</th></tr>
        <tr><td><code>sdgeStats</code></td><td><span class="badge badge-open">Public</span></td><td>totalDocs, ledgerSeq, chainHealth, onlineSince</td></tr>
        <tr><td><code>sdgeLookupDoc(docId)</code></td><td><span class="badge badge-open">Public</span></td><td>Fetch document by docId</td></tr>
        <tr><td><code>sdgeListDocs(domain?, limit, offset)</code></td><td><span class="badge badge-auth">Actor</span></td><td>List documents, optionally filtered by domain</td></tr>
        <tr><td><code>sdgeVerifyChain</code></td><td><span class="badge badge-open">Public</span></td><td>Verify full chain integrity</td></tr>
        <tr><td><code>sdgeDomainStats</code></td><td><span class="badge badge-open">Public</span></td><td>Per-domain document counts</td></tr>
        <tr><td><code>sdgeLookupReceipt(receiptId)</code></td><td><span class="badge badge-open">Public</span></td><td>Verify a ZK receipt</td></tr>
      </table>
    </section>

    <!-- Mutations -->
    <section id="mutations">
      <h2>‚úèÔ∏è Mutations</h2>
      <table>
        <tr><th>Mutation</th><th>Auth</th><th>Description</th></tr>
        <tr><td><code>sdgeIngestDocument(input)</code></td><td><span class="badge badge-auth">Actor</span></td><td>Ingest a document ‚Äî returns full ledger entry with ZK receipt</td></tr>
      </table>
      <h3>Input fields for <code>sdgeIngestDocument</code></h3>
      <table>
        <tr><th>Field</th><th>Required</th><th>Description</th></tr>
        <tr><td><code>filename</code></td><td>‚úì</td><td>Original filename of the document</td></tr>
        <tr><td><code>actorId</code></td><td>‚úì</td><td>Authenticated actor ID (e.g. <code>actor-land-reg-01</code>)</td></tr>
        <tr><td><code>domain</code></td><td>‚úì</td><td>DocumentDomain enum value</td></tr>
        <tr><td><code>content</code></td><td>‚úì</td><td>Full text content of the document to be hashed and stored</td></tr>
      </table>
    </section>

    <!-- Workflow Guide -->
    <section id="workflow-guide">
      <h2>‚öôÔ∏è Automation Guide</h2>
      <p>The <a href="/workflows" style="color:#60a5fa">/workflows</a> page provides 11 pre-built automation workflows across 4 categories:</p>
      <ul>
        <li><strong>Ingest Automations</strong> ‚Äî Bulk, scheduled pulls from source APIs (LRC, GSTN, NHA, GeM)</li>
        <li><strong>Verification & Audit</strong> ‚Äî Chain integrity scan, fraud pipeline, identity dedup, IoT sweep</li>
        <li><strong>Reporting & Export</strong> ‚Äî Daily digest, court approval flow, municipal consolidation</li>
      </ul>
      <p>Each workflow can be triggered on-demand, scheduled (hourly/daily/weekly), or chained. Schedule state is stored in the session and persists in <code>localStorage</code>.</p>
      <div class="info-box">
        <strong>Production:</strong> In a production deployment, workflows are managed by the <code>@ankr/workflow-engine</code> package ‚Äî a cron-backed orchestrator with webhook triggers, retry logic, and audit log persistence.
      </div>
    </section>

    <!-- Fraud Detection -->
    <section id="fraud">
      <h2>üïµÔ∏è Fraud Detection</h2>
      <p>The SDGE fraud scoring engine runs on every ingest. It evaluates several signals:</p>
      <ul>
        <li><strong>Content entropy</strong> ‚Äî random or garbled content scores higher</li>
        <li><strong>Actor domain mismatch</strong> ‚Äî a HEALTH actor ingesting LAND documents is flagged</li>
        <li><strong>Duplicate content hash</strong> ‚Äî exact duplicates score 100 (blocked)</li>
        <li><strong>Known fraud patterns</strong> ‚Äî regex matches for forged Aadhaar numbers, fake GSTINs</li>
        <li><strong>Temporal anomalies</strong> ‚Äî document dated in the future or >10 years old</li>
      </ul>
      <p>To run a full fraud investigation across all high-risk documents, use the <a href="/workflows" style="color:#60a5fa">Fraud Investigation Pipeline</a> workflow.</p>
    </section>

  </div>
</div>

<script>
// Load live doc count
fetch('/graphql',{method:'POST',headers:{'Content-Type':'application/json'},
  body:JSON.stringify({query:'{ sdgeStats { totalDocs } }'})})
  .then(r=>r.json()).then(j=>{
    const n = j.data?.sdgeStats?.totalDocs;
    if(n) document.getElementById('doc-count').textContent = n + ' documents';
  }).catch(()=>{});

// TOC active highlight on scroll
const sections = document.querySelectorAll('section[id]');
const links = document.querySelectorAll('.toc-link');
const obs = new IntersectionObserver(entries=>{
  entries.forEach(e=>{
    if(e.isIntersecting){
      links.forEach(l=>l.classList.remove('active'));
      const a = document.querySelector(`.toc-link[href="#${e.target.id}"]`);
      if(a) a.classList.add('active');
    }
  });
},{rootMargin:'-30% 0px -60% 0px'});
sections.forEach(s=>obs.observe(s));
</script>
</body>
</html>
